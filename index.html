<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Demo | Trading Intelligence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f9; }
        .card { border: none; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1); }
        pre { background: #212529; color: #0dcaf0; padding: 1rem; border-radius: 0.25rem; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <h1 class="text-center mb-4 text-primary">Auth System Demo</h1>

            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">User Registration</h5>
                    <div class="mb-3">
                        <input id="regName" class="form-control" placeholder="Full Name">
                    </div>
                    <div class="mb-3">
                        <input id="regEmail" class="form-control" placeholder="Email Address">
                    </div>
                    <div class="mb-3">
                        <input id="regPassword" class="form-control" type="password" placeholder="Password">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Assign Role</label>
                        <select id="regRole" class="form-select">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button class="btn btn-primary w-100" onclick="register()">Register</button>
                    <div class="mt-3">
                        <pre id="regResult" class="small">Waiting for input...</pre>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Login</h5>
                    <div class="mb-3">
                        <input id="loginEmail" class="form-control" placeholder="Email Address">
                    </div>
                    <div class="mb-3">
                        <input id="loginPassword" class="form-control" type="password" placeholder="Password">
                    </div>
                    <button class="btn btn-success w-100" onclick="login()">Sign In</button>
                    <div class="mt-3">
                        <pre id="loginResult" class="small">Status: Not Logged In</pre>
                    </div>
                </div>
            </div>

            <div class="card mb-4 border-warning">
                <div class="card-body">
                    <h5 class="card-title">Protected Content</h5>
                    <p class="card-text small text-muted">Only accessible with valid Admin JWT.</p>
                    <button class="btn btn-dark w-100" onclick="adminOnly()">Call /admin-only API</button>
                    <div class="mt-3">
                        <pre id="adminResult" class="small">Status: No access</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Note: Ensure your backend uses CORS so this frontend can connect.
    const API_BASE = 'http://localhost:5000/api/v1/auth';
    let token = null;

    async function register() {
        const body = {
            name: document.getElementById('regName').value,
            email: document.getElementById('regEmail').value,
            password: document.getElementById('regPassword').value,
            role: document.getElementById('regRole').value
        };
        const res = await fetch(API_BASE + '/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const data = await res.json();
        document.getElementById('regResult').textContent = JSON.stringify(data, null, 2);
    }

    async function login() {
        const body = {
            email: document.getElementById('loginEmail').value,
            password: document.getElementById('loginPassword').value
        };
        const res = await fetch(API_BASE + '/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const data = await res.json();
        if (res.ok && data.token) {
            token = data.token;
            // Best practice: Store in localStorage for persistence during testing.
            localStorage.setItem('authToken', data.token);
        }
        document.getElementById('loginResult').textContent = JSON.stringify(data, null, 2);
    }

    async function adminOnly() {
        // Retrieve token from local variable or storage.
        const activeToken = token || localStorage.getItem('authToken');
        
        if (!activeToken) {
            document.getElementById('adminResult').textContent = 'Error: No JWT found. Please login first.';
            return;
        }
        const res = await fetch(API_BASE + '/admin-only', {
            headers: { 'Authorization': 'Bearer ' + activeToken }
        });
        const data = await res.json();
        document.getElementById('adminResult').textContent = JSON.stringify(data, null, 2);
    }
</script>

</body>
</html>